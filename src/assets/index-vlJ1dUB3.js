import{_ as $}from"./arco-table-D7Ntzbsx.js";import{_ as K}from"./arco-icon-CunFPY5n.js";import{_ as T,u as F}from"./useRenderModal-BiI04mzw.js";import{l as M,s as O,a as w}from"./index-DP0JwgWw.js";import{a as b,D as V}from"./api-CmsgK-9p.js";import{C as z}from"./area-data-D0wmM6tf.js";import{d as U,a as E,r as h,s as B,B as P,f as m,h as j,o as q,w as s,e as t,u as a,i as v,q as R,c as H,b as C,F as G}from"./index-B3mkc1PU.js";const J=U({__name:"add",props:{id:{default:""}},setup(D,{expose:n}){const k=D,y=E(),d=h({data:{form:{id:"",areaCode:"",deptId:"",companyName:"",name:"",sex:"",lawCard:""},rules:{areaCode:[{required:!0,message:"请选择所属区域"}],deptId:[{required:!0,message:"请选择所属部门"}],companyName:[{required:!0,message:"请输入所属机构"}],name:[{required:!0,message:"请输入姓名"}],sex:[{required:!0,message:"请选择性别"}],lawCard:[{required:!0,message:"请输入执法证件号码"}]}}}),A=async()=>{const{data:o}=await b.getLawEnforcementOfficerDetailApi(k.id);Object.assign(d.data.form,{id:o.id,areaCode:o.areaCode,deptId:o.deptId,companyName:o.companyName,name:o.name,sex:o.sex,lawCard:o.lawCard})},l=h({data:{options:[],fieldNames:{value:"code",label:"name"}}}),p=async()=>{l.data.options=await z("pcaCode")},N=o=>{g.data.options.length=0,d.data.form.deptId="",o&&x()},g=h({data:{options:[],fieldNames:{value:"id",label:"name"}}}),x=async()=>{const{data:o}=await V.getDeptListApi({areaCode:d.data.form.areaCode,keyword:"",pageNum:1,pageSize:9999});g.data.options=o.currentList};return n({form:d.data.form,async submit(){return await y.value.validate()}}),B(()=>{p(),k.id&&Promise.all([A()]).then(()=>{x()})}),P(()=>{y.value.resetFields(Object.keys(d.data.form))}),(o,e)=>{const u=m("a-cascader"),c=m("a-form-item"),f=m("a-select"),_=m("a-input"),L=m("a-option"),I=m("a-form"),S=m("a-scrollbar");return q(),j(S,{style:{maxHeight:"calc(100vh - 250px)",overflow:"auto"}},{default:s(()=>[t(I,{ref_key:"form",ref:y,model:a(d).data.form,rules:a(d).data.rules,disabled:a(M),"auto-label-width":"","scroll-to-first-error":""},{default:s(()=>[t(c,{label:"所属区域",field:"areaCode"},{default:s(()=>[t(u,{"model-value":a(d).data.form.areaCode,"onUpdate:modelValue":e[0]||(e[0]=r=>a(d).data.form.areaCode=r),options:a(l).data.options,"field-names":a(l).data.fieldNames,"allow-clear":"",placeholder:"请选择所属区域",onChange:N},null,8,["model-value","options","field-names"])]),_:1}),t(c,{label:"所属部门",field:"deptId"},{default:s(()=>[t(f,{"model-value":a(d).data.form.deptId,"onUpdate:modelValue":e[1]||(e[1]=r=>a(d).data.form.deptId=r),options:a(g).data.options,"field-names":a(g).data.fieldNames,"allow-clear":"",placeholder:"请选择所属部门"},null,8,["model-value","options","field-names"])]),_:1}),t(c,{label:"所属机构",field:"companyName"},{default:s(()=>[t(_,{"model-value":a(d).data.form.companyName,"onUpdate:modelValue":e[2]||(e[2]=r=>a(d).data.form.companyName=r),placeholder:"请输入所属机构"},null,8,["model-value"])]),_:1}),t(c,{label:"姓名",field:"name"},{default:s(()=>[t(_,{"model-value":a(d).data.form.name,"onUpdate:modelValue":e[3]||(e[3]=r=>a(d).data.form.name=r),placeholder:"请输入姓名"},null,8,["model-value"])]),_:1}),t(c,{label:"性别",field:"sex"},{default:s(()=>[t(f,{"model-value":a(d).data.form.sex,"onUpdate:modelValue":e[4]||(e[4]=r=>a(d).data.form.sex=r),placeholder:"请选择性别"},{default:s(()=>[t(L,{value:"男"},{default:s(()=>e[6]||(e[6]=[v("男",-1)])),_:1,__:[6]}),t(L,{value:"女"},{default:s(()=>e[7]||(e[7]=[v("女",-1)])),_:1,__:[7]})]),_:1},8,["model-value"])]),_:1}),t(c,{label:"执法证件号码",field:"lawCard"},{default:s(()=>[t(_,{"model-value":a(d).data.form.lawCard,"onUpdate:modelValue":e[5]||(e[5]=r=>a(d).data.form.lawCard=r),placeholder:"请输入执法证件号码"},null,8,["model-value"])]),_:1})]),_:1},8,["model","rules","disabled"])]),_:1})}}}),Q={class:"filter-content"},X={class:"select-content"},Y={class:"search-content"},Z={class:"search-content-buttons"},ee={class:"search"},ie=U({__name:"index",setup(D){const n=h({data:{area:{fieldNames:{value:"code",label:"name"},options:[],value:""},dept:{fieldNames:{value:"id",label:"name"},options:[],value:""},keyword:""}}),k=async()=>{n.data.area.options=await z("pcaCode")},y=o=>{n.data.dept.options.length=0,n.data.dept.value="",o&&d()},d=async()=>{const{data:o}=await V.getDeptListApi({areaCode:n.data.area.value,keyword:"",pageNum:1,pageSize:9999});n.data.dept.options=o.currentList},A=E(),l=h({data:{columns:[{title:"姓名",dataIndex:"name",align:"center",width:150,minWidth:100},{title:"所属区域",dataIndex:"areaNames",align:"center",minWidth:200},{title:"所属部门",dataIndex:"deptName",align:"center",minWidth:200},{title:"所属机构",dataIndex:"companyName",align:"center",minWidth:200},{title:"执法证号",dataIndex:"lawCard",align:"center",minWidth:200},{title:"添加时间",dataIndex:"createTime",align:"center",minWidth:200},{title:"操作",slotName:"optional",align:"center",fixed:"right",minWidth:200}],list:[],pagination:{show:!0,total:0,pageNum:1,pageSize:10},tableRowSelection:{width:40,type:"checkbox",selectedRowKeys:[],showCheckedAll:!0}}}),p=async()=>{const{data:o}=await b.getLawEnforcementOfficerListApi({areaCode:n.data.area.value,deptId:n.data.dept.value,keyword:n.data.keyword,pageNum:l.data.pagination.pageNum,pageSize:l.data.pagination.pageSize}),{currentList:e,totalRecords:u}=o;l.data.list=e,l.data.pagination.total=u};R(()=>[n.data.area.value,n.data.dept.value,n.data.keyword,l.data.pagination.pageSize],()=>{l.data.pagination.pageNum>1?l.data.pagination.pageNum=1:p()}),R(()=>l.data.pagination.pageNum,p);const N=o=>{const{instance:e,toggleVisible:u}=F({component:J,props:{id:o},modalProps:{title:`${o?"编辑":"添加"}执法人员`,draggable:!0,async onBeforeOk(){try{await e.value.submit()||(await b.addLawEnforcementOfficerApi(e.value.form),w("success",{content:"添加成功"}),p(),u())}catch{return!1}}}})},g=async o=>{O("warning",{title:"删除",content:"确认删除该执法人员吗？",okText:"确认",hideCancel:!1,onOk:async()=>{try{await b.deleteLawEnforcementOfficerApi([o]),w("success",{content:"删除成功"}),p()}catch{w("error",{content:"删除失败"})}}})},x=async()=>{var o;if(!((o=l.data.tableRowSelection.selectedRowKeys)!=null&&o.length)){w("warning",{content:"请选择要删除的执法人员"});return}O("warning",{title:"删除",content:"确认批量删除执法人员吗？",okText:"确认",hideCancel:!1,onOk:async()=>{try{await b.deleteLawEnforcementOfficerApi(l.data.tableRowSelection.selectedRowKeys),w("success",{content:"删除成功"}),p()}catch{w("error",{content:"删除失败"})}}})};return B(()=>{k(),p()}),(o,e)=>{const u=m("a-cascader"),c=m("a-select"),f=m("a-space"),_=T,L=K,I=m("a-input-search"),S=m("a-link"),r=$;return q(),H(G,null,[C("div",Q,[C("div",X,[t(f,null,{default:s(()=>[t(u,{"model-value":a(n).data.area.value,"onUpdate:modelValue":e[0]||(e[0]=i=>a(n).data.area.value=i),options:a(n).data.area.options,"field-names":a(n).data.area.fieldNames,style:{width:"200px"},"allow-clear":"",placeholder:"请选择所属区域",onChange:y},null,8,["model-value","options","field-names"]),t(c,{"model-value":a(n).data.dept.value,"onUpdate:modelValue":e[1]||(e[1]=i=>a(n).data.dept.value=i),options:a(n).data.dept.options,"field-names":a(n).data.dept.fieldNames,style:{width:"200px"},"allow-clear":"",placeholder:"请选择所属部门"},null,8,["model-value","options","field-names"])]),_:1})]),C("div",Y,[t(f,null,{default:s(()=>[C("div",Z,[t(f,null,{default:s(()=>[t(_,{type:"primary",onClick:e[2]||(e[2]=i=>N(""))},{default:s(()=>e[7]||(e[7]=[v(" 添加 ",-1)])),_:1,__:[7]}),t(_,{type:"outline",onClick:x},{default:s(()=>e[8]||(e[8]=[v(" 批量删除 ",-1)])),_:1,__:[8]})]),_:1})]),C("div",ee,[t(I,{"default-value":a(n).data.keyword,"allow-clear":"","search-button":"","button-text":"查询",placeholder:"输入关键字搜索",onChange:e[3]||(e[3]=i=>a(n).data.keyword=i)},{"button-icon":s(()=>[t(L,{icon:"icon-search"})]),_:1},8,["default-value"])])]),_:1})])]),t(r,{ref_key:"table",ref:A,"row-key":"id","selected-keys":a(l).data.tableRowSelection.selectedRowKeys,"onUpdate:selectedKeys":e[4]||(e[4]=i=>a(l).data.tableRowSelection.selectedRowKeys=i),"row-selection":a(l).data.tableRowSelection,columns:a(l).data.columns,data:a(l).data.list,pagination:a(l).data.pagination,"column-resizable":!0,onCurrentChange:e[5]||(e[5]=i=>a(l).data.pagination.pageNum=i),onPageSizeChange:e[6]||(e[6]=i=>a(l).data.pagination.pageSize=i)},{optional:s(({record:i})=>[t(f,{size:"medium"},{default:s(()=>[t(S,{status:"warning",hoverable:!1,onClick:W=>N(i.id)},{default:s(()=>e[9]||(e[9]=[v(" 编辑 ",-1)])),_:2,__:[9]},1032,["onClick"]),t(S,{status:"danger",hoverable:!1,onClick:W=>g(i.id)},{default:s(()=>e[10]||(e[10]=[v(" 删除 ",-1)])),_:2,__:[10]},1032,["onClick"])]),_:2},1024)]),_:1},8,["selected-keys","row-selection","columns","data","pagination"])],64)}}});export{ie as default};
