import{_ as M}from"./arco-table-D7Ntzbsx.js";import{_ as W}from"./arco-icon-CunFPY5n.js";import{_ as q,u as E}from"./useRenderModal-BiI04mzw.js";import{U as f}from"./api-CmsgK-9p.js";import{l as j,s as B,a as g}from"./index-DP0JwgWw.js";import{d as D,e as I}from"./3DES-CrfUPAaI.js";import{d as L,a as $,r as R,s as K,B as P,f as u,h as V,o as k,w as l,e as n,u as t,c as O,F as T,m as H,i as h,t as G,z,q as A,b as v}from"./index-B3mkc1PU.js";const J=L({__name:"add",props:{id:{default:""}},setup(N,{expose:s}){const b=N,w=$(),a=R({data:{form:{id:"",roles:"",name:"",phone:""},rules:{roles:[{required:!0,message:"请选择角色"}],name:[{required:!0,message:"请输入姓名"}],phone:[{required:!0,message:"请输入手机号码"}]}}}),p=async()=>{const{data:m}=await f.getUserDetailApi(b.id);Object.assign(a.data.form,{id:m.id,roles:m.roles,name:m.name,phone:D(m.phone)})},y=R({data:{list:[]}}),x=async()=>{const{data:m}=await f.getRoleListApi();y.data.list=m};return s({form:a.data.form,async submit(){return await w.value.validate()}}),K(()=>{x(),b.id&&p()}),P(()=>{w.value.resetFields(Object.keys(a.data.form))}),(m,o)=>{const e=u("a-radio"),i=u("a-radio-group"),c=u("a-form-item"),_=u("a-input"),C=u("a-form"),S=u("a-scrollbar");return k(),V(S,{style:{maxHeight:"calc(100vh - 250px)",overflow:"auto"}},{default:l(()=>[n(C,{ref_key:"form",ref:w,model:t(a).data.form,rules:t(a).data.rules,disabled:t(j),"auto-label-width":"","scroll-to-first-error":""},{default:l(()=>[n(c,{label:"角色",field:"roles"},{default:l(()=>[n(i,{modelValue:t(a).data.form.roles,"onUpdate:modelValue":o[0]||(o[0]=d=>t(a).data.form.roles=d)},{default:l(()=>[(k(!0),O(T,null,H(t(y).data.list,(d,U)=>(k(),V(e,{key:U,value:d.key},{default:l(()=>[h(G(d.value),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(c,{label:"姓名",field:"name"},{default:l(()=>[n(_,{"model-value":t(a).data.form.name,"onUpdate:modelValue":o[1]||(o[1]=d=>t(a).data.form.name=d),placeholder:"请输入姓名"},null,8,["model-value"])]),_:1}),n(c,{label:"手机号码",field:"phone"},{default:l(()=>[n(_,{"model-value":t(a).data.form.phone,"onUpdate:modelValue":o[2]||(o[2]=d=>t(a).data.form.phone=d),placeholder:"请输入手机号码"},null,8,["model-value"])]),_:1})]),_:1},8,["model","rules","disabled"])]),_:1})}}}),Q={class:"filter-content"},X={class:"select-content"},Y={class:"search-content"},Z={class:"search-content-buttons"},ee={class:"search"},ie=L({__name:"index",setup(N){const s=R({data:{role:{fieldNames:{value:"key",label:"value"},options:[],value:""},keyword:""}}),b=async()=>{const{data:o}=await f.getRoleListApi();s.data.role.options=o},w=$(),a=R({data:{columns:[{title:"角色",align:"center",render({record:o}){const i=s.data.role.options.find(c=>c.key===o.roles);return z("span",{},(i==null?void 0:i.value)||"")},minWidth:200},{title:"姓名",dataIndex:"name",align:"center",minWidth:200},{title:"手机号",align:"center",render({record:o}){return z("span",{},D(o.phone))},minWidth:200},{title:"添加时间",dataIndex:"createTime",align:"center",minWidth:200},{title:"操作",slotName:"optional",align:"center",fixed:"right",minWidth:200}],list:[],pagination:{show:!0,total:0,pageNum:1,pageSize:10},tableRowSelection:{width:40,type:"checkbox",selectedRowKeys:[],showCheckedAll:!0}}}),p=async()=>{const{data:o}=await f.getUserListApi({roles:s.data.role.value,keyword:s.data.keyword,pageNum:a.data.pagination.pageNum,pageSize:a.data.pagination.pageSize}),{currentList:e,totalRecords:i}=o;a.data.list=e,a.data.pagination.total=i};A(()=>[s.data.role.value,s.data.keyword,a.data.pagination.pageSize],()=>{a.data.pagination.pageNum>1?a.data.pagination.pageNum=1:p()}),A(()=>a.data.pagination.pageNum,p);const y=o=>{const{instance:e,toggleVisible:i}=E({component:J,props:{id:o},modalProps:{title:`${o?"编辑":"添加"}用户`,draggable:!0,async onBeforeOk(){try{await e.value.submit()||(await f.addUserApi({...e.value.form,phone:I(e.value.form.phone)}),g("success",{content:"添加成功"}),p(),i())}catch{return!1}}}})},x=async o=>{B("warning",{title:"删除",content:"确认删除该用户吗？",okText:"确认",hideCancel:!1,onOk:async()=>{try{await f.deleteUserApi([o]),g("success",{content:"删除成功"}),p()}catch{g("error",{content:"删除失败"})}}})},m=()=>{var o;if(!((o=a.data.tableRowSelection.selectedRowKeys)!=null&&o.length)){g("warning",{content:"请选择要删除的用户"});return}B("warning",{title:"删除",content:"确认批量删除用户吗？",okText:"确认",hideCancel:!1,onOk:async()=>{try{await f.deleteUserApi(a.data.tableRowSelection.selectedRowKeys),g("success",{content:"删除成功"}),p()}catch{g("error",{content:"删除失败"})}}})};return K(()=>{b(),p()}),(o,e)=>{const i=u("a-select"),c=q,_=u("a-space"),C=W,S=u("a-input-search"),d=u("a-link"),U=M;return k(),O(T,null,[v("div",Q,[v("div",X,[n(i,{"model-value":t(s).data.role.value,"onUpdate:modelValue":e[0]||(e[0]=r=>t(s).data.role.value=r),options:t(s).data.role.options,"field-names":t(s).data.role.fieldNames,style:{width:"200px"},"allow-clear":"",placeholder:"选择用户角色"},null,8,["model-value","options","field-names"])]),v("div",Y,[n(_,null,{default:l(()=>[v("div",Z,[n(_,null,{default:l(()=>[n(c,{type:"primary",onClick:e[1]||(e[1]=r=>y(""))},{default:l(()=>e[6]||(e[6]=[h(" 添加 ",-1)])),_:1,__:[6]}),n(c,{type:"outline",onClick:m},{default:l(()=>e[7]||(e[7]=[h(" 批量删除 ",-1)])),_:1,__:[7]})]),_:1})]),v("div",ee,[n(S,{"default-value":t(s).data.keyword,"allow-clear":"","search-button":"","button-text":"查询",placeholder:"输入关键字搜索",onChange:e[2]||(e[2]=r=>t(s).data.keyword=r)},{"button-icon":l(()=>[n(C,{icon:"icon-search"})]),_:1},8,["default-value"])])]),_:1})])]),n(U,{ref_key:"table",ref:w,"row-key":"id","selected-keys":t(a).data.tableRowSelection.selectedRowKeys,"onUpdate:selectedKeys":e[3]||(e[3]=r=>t(a).data.tableRowSelection.selectedRowKeys=r),"row-selection":t(a).data.tableRowSelection,columns:t(a).data.columns,data:t(a).data.list,pagination:t(a).data.pagination,"column-resizable":!0,onCurrentChange:e[4]||(e[4]=r=>t(a).data.pagination.pageNum=r),onPageSizeChange:e[5]||(e[5]=r=>t(a).data.pagination.pageSize=r)},{optional:l(({record:r})=>[n(_,{size:"medium"},{default:l(()=>[n(d,{status:"warning",hoverable:!1,onClick:F=>y(r.id)},{default:l(()=>e[8]||(e[8]=[h(" 编辑 ",-1)])),_:2,__:[8]},1032,["onClick"]),n(d,{status:"danger",hoverable:!1,onClick:F=>x(r.id)},{default:l(()=>e[9]||(e[9]=[h(" 删除 ",-1)])),_:2,__:[9]},1032,["onClick"])]),_:2},1024)]),_:1},8,["selected-keys","row-selection","columns","data","pagination"])],64)}}});export{ie as default};
