import{_ as U}from"./arco-table-D7Ntzbsx.js";import{_ as B}from"./arco-icon-CunFPY5n.js";import{_ as W,u as $}from"./useRenderModal-BiI04mzw.js";import{b as f,J as L}from"./api-CmsgK-9p.js";import{l as q,s as F,a as J}from"./index-DP0JwgWw.js";import{d as z,a as M,r as b,s as R,B as O,f as p,h as P,o as A,w as r,e as o,u as a,y as D,q as S,c as K,b as v,F as j,i as N}from"./index-B3mkc1PU.js";const E=z({__name:"add-label-2",props:{id:{default:""}},setup(x,{expose:t}){const w=x,_=M(),d=b({data:{form:{id:"",level:2,bankCateId:"",parentId:"",code:"",content:""},rules:{bankCateId:[{required:!0,message:"请选择评判标签类型"}],parentId:[{required:!0,message:"请选择一级标签"}],code:[{required:!0,message:"请输入编号"}],content:[{required:!0,message:"请输入内容"}]}}}),k=async()=>{const{data:e}=await f.getJudgementTagDetailApi(w.id);Object.assign(d.data.form,{id:e.id,level:e.level,bankCateId:e.bankCateId,parentId:e.parentId,code:e.code,content:e.content}),e.bankCateId&&s()},l=b({data:{options:[],fieldNames:{label:"name",value:"id"}}}),u=async()=>{const{data:e}=await L.getJudgementTagTypeListApi({keyword:"",pageNum:1,pageSize:9999});l.data.options=e.currentList},y=e=>{c.data.options.length=0,d.data.form.parentId="",e&&s()},c=b({data:{options:[],fieldNames:{label:"content",value:"id"}}}),s=async()=>{const{data:e}=await f.getJudgementTagListApi({level:"1",bankCateId:d.data.form.bankCateId,pageNum:1,pageSize:9999});c.data.options=e.currentList};return t({form:d.data.form,async submit(){return await _.value.validate()}}),R(()=>{u(),w.id&&k()}),O(()=>{_.value.resetFields(Object.keys(d.data.form))}),(e,i)=>{const m=p("a-select"),g=p("a-form-item"),h=p("a-input"),C=p("a-textarea"),T=p("a-form"),I=p("a-scrollbar");return A(),P(I,{style:{maxHeight:"calc(100vh - 250px)",overflow:"auto"}},{default:r(()=>[o(T,{ref_key:"form",ref:_,model:a(d).data.form,rules:a(d).data.rules,disabled:a(q),"auto-label-width":"","scroll-to-first-error":""},{default:r(()=>[o(g,{label:"评判标签类型",field:"bankCateId"},{default:r(()=>[o(m,{"model-value":a(d).data.form.bankCateId,"onUpdate:modelValue":i[0]||(i[0]=n=>a(d).data.form.bankCateId=n),options:a(l).data.options,"field-names":a(l).data.fieldNames,"allow-clear":"",placeholder:"请选择评判标签类型",onChange:y},null,8,["model-value","options","field-names"])]),_:1}),o(g,{label:"一级标签",field:"parentId"},{default:r(()=>[o(m,{"model-value":a(d).data.form.parentId,"onUpdate:modelValue":i[1]||(i[1]=n=>a(d).data.form.parentId=n),options:a(c).data.options,"field-names":a(c).data.fieldNames,"allow-clear":"",placeholder:"请选择一级标签"},null,8,["model-value","options","field-names"])]),_:1}),o(g,{label:"编号",field:"code"},{default:r(()=>[o(h,{"model-value":a(d).data.form.code,"onUpdate:modelValue":i[2]||(i[2]=n=>a(d).data.form.code=n),placeholder:"编号"},null,8,["model-value"])]),_:1}),o(g,{label:"内容",field:"content"},{default:r(()=>[o(C,{"model-value":a(d).data.form.content,"onUpdate:modelValue":i[3]||(i[3]=n=>a(d).data.form.content=n),"auto-size":{minRows:2,maxRows:10},"allow-clear":"",placeholder:"内容"},null,8,["model-value"])]),_:1})]),_:1},8,["model","rules","disabled"])]),_:1})}}}),H={class:"filter-content"},G={class:"select-content"},Q={class:"search-content"},X={class:"search-content-buttons"},Y={class:"search"},le=z({__name:"label-2",setup(x){const t=b({data:{JudgementTagType:{fieldNames:{label:"name",value:"id"},options:[],value:""},parent:{fieldNames:{label:"content",value:"id"},options:[],value:""},keyword:""}}),w=async()=>{const{data:s}=await L.getJudgementTagTypeListApi({keyword:"",pageNum:1,pageSize:9999});t.data.JudgementTagType.options=s.currentList},_=s=>{t.data.parent.options.length=0,t.data.parent.value="",s&&d()},d=async()=>{const{data:s}=await f.getJudgementTagListApi({level:"1",bankCateId:t.data.JudgementTagType.value,pageNum:1,pageSize:9999});t.data.parent.options=s.currentList},k=D("table"),l=b({data:{columns:[{title:"标签编号",dataIndex:"code",align:"center",width:100,minWidth:100},{title:"标签内容",dataIndex:"content",align:"center",minWidth:200},{title:"评判标签类型",dataIndex:"bankCateName",align:"center",width:200,minWidth:200},{title:"一级标签",dataIndex:"parentContent",align:"center",width:200,minWidth:200},{title:"添加时间",dataIndex:"createTime",align:"center",width:200,minWidth:200},{title:"操作",slotName:"optional",align:"center",fixed:"right",width:200,minWidth:200}],list:[],pagination:{show:!0,total:0,pageNum:1,pageSize:10},tableRowSelection:{width:40,type:"checkbox",selectedRowKeys:[],showCheckedAll:!0}}}),u=async()=>{const{data:s}=await f.getJudgementTagListApi({level:"2",bankCateId:t.data.JudgementTagType.value,parentId:t.data.parent.value,keyword:t.data.keyword,pageNum:l.data.pagination.pageNum,pageSize:l.data.pagination.pageSize}),{currentList:e,totalRecords:i}=s;l.data.list=e,l.data.pagination.total=i};S(()=>[t.data.JudgementTagType.value,t.data.parent.value,t.data.keyword,l.data.pagination.pageSize],()=>{l.data.pagination.pageNum>1?l.data.pagination.pageNum=1:u()}),S(()=>l.data.pagination.pageNum,u);const y=s=>{const{instance:e,toggleVisible:i}=$({component:E,props:{id:s},modalProps:{title:s?"编辑评判项标签":"添加评判项标签",draggable:!0,async onBeforeOk(){try{await e.value.submit()||(await f.addJudgementTagApi(e.value.form),J("success",{content:"添加成功"}),u(),i())}catch{return!1}}}})},c=s=>{F("warning",{title:"删除",content:"确认删除该评判项标签吗？",okText:"确认",hideCancel:!1,onOk:async()=>{try{await f.deleteJudgementTagApi(s),J("success",{content:"删除成功"}),u()}catch{J("error",{content:"删除失败"})}}})};return R(()=>{w(),u()}),(s,e)=>{const i=p("a-select"),m=p("a-space"),g=W,h=B,C=p("a-input-search"),T=p("a-link"),I=U;return A(),K(j,null,[v("div",H,[v("div",G,[o(m,null,{default:r(()=>[o(i,{"model-value":a(t).data.JudgementTagType.value,"onUpdate:modelValue":e[0]||(e[0]=n=>a(t).data.JudgementTagType.value=n),options:a(t).data.JudgementTagType.options,"field-names":a(t).data.JudgementTagType.fieldNames,style:{width:"200px"},"allow-clear":"",placeholder:"选择评判标签类型",onChange:_},null,8,["model-value","options","field-names"]),o(i,{"model-value":a(t).data.parent.value,"onUpdate:modelValue":e[1]||(e[1]=n=>a(t).data.parent.value=n),options:a(t).data.parent.options,"field-names":a(t).data.parent.fieldNames,style:{width:"200px"},"allow-clear":"",placeholder:"选择一级标签"},null,8,["model-value","options","field-names"])]),_:1})]),v("div",Q,[o(m,null,{default:r(()=>[v("div",X,[o(m,null,{default:r(()=>[o(g,{type:"primary",onClick:e[2]||(e[2]=n=>y(""))},{default:r(()=>e[7]||(e[7]=[N(" 添加 ",-1)])),_:1,__:[7]})]),_:1})]),v("div",Y,[o(C,{"default-value":a(t).data.keyword,"allow-clear":"","search-button":"","button-text":"查询",placeholder:"输入关键字搜索",onChange:e[3]||(e[3]=n=>a(t).data.keyword=n)},{"button-icon":r(()=>[o(h,{icon:"icon-search"})]),_:1},8,["default-value"])])]),_:1})])]),o(I,{ref_key:"table",ref:k,"row-key":"id","selected-keys":a(l).data.tableRowSelection.selectedRowKeys,"onUpdate:selectedKeys":e[4]||(e[4]=n=>a(l).data.tableRowSelection.selectedRowKeys=n),"row-selection":a(l).data.tableRowSelection,columns:a(l).data.columns,data:a(l).data.list,pagination:a(l).data.pagination,"column-resizable":!0,onCurrentChange:e[5]||(e[5]=n=>a(l).data.pagination.pageNum=n),onPageSizeChange:e[6]||(e[6]=n=>a(l).data.pagination.pageSize=n)},{optional:r(({record:n})=>[o(m,{size:"medium"},{default:r(()=>[o(T,{status:"warning",hoverable:!1,onClick:V=>y(n.id)},{default:r(()=>e[8]||(e[8]=[N(" 编辑 ",-1)])),_:2,__:[8]},1032,["onClick"]),o(T,{status:"danger",hoverable:!1,onClick:V=>c(n.id)},{default:r(()=>e[9]||(e[9]=[N(" 删除 ",-1)])),_:2,__:[9]},1032,["onClick"])]),_:2},1024)]),_:1},8,["selected-keys","row-selection","columns","data","pagination"])],64)}}});export{le as default};
