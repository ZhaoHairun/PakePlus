import{_ as K}from"./arco-table-D7Ntzbsx.js";import{_ as E}from"./arco-icon-CunFPY5n.js";import{l as L,s as W,a as R}from"./index-DP0JwgWw.js";import{D as H,R as k}from"./api-CmsgK-9p.js";import{C as j}from"./area-data-D0wmM6tf.js";import{d as F,a as G,r as y,s as T,B as J,f as _,h as q,o as g,w as r,e as s,u as a,q as P,b as t,t as f,c as w,F as V,m as O,n as Q,_ as X,y as Y,z as U,i as S,H as Z}from"./index-B3mkc1PU.js";import{P as tt}from"./previewPDF-DiIaB3wn.js";import{u as B,_ as M}from"./useRenderModal-BiI04mzw.js";const et=F({__name:"add",setup(z,{expose:u}){const l=G(),o=y({data:{form:{areaCode:"",deptId:"",deptCateName:"",file:""},rules:{areaCode:[{required:!0,message:"请选择区域"}],deptId:[{required:!0,message:"请选择所属部门"}],deptCateName:[{required:!0,message:"请输入部门大类"}],file:[{required:!0,message:"请上传文件"}]}}}),i=y({data:{options:[],fieldNames:{value:"code",label:"name"}}}),C=async()=>{i.data.options=await j("pcaCode")},x=d=>{h.data.options.length=0,o.data.form.deptId="",d&&m()},h=y({data:{options:[],fieldNames:{value:"id",label:"name"}}}),m=async()=>{const{data:d}=await H.getDeptListApi({areaCode:o.data.form.areaCode,keyword:"",pageNum:1,pageSize:9999});h.data.options=d.currentList},e=d=>{o.data.form.file=d.fileItem.file,d.onSuccess()},n=()=>(o.data.form.file="",new Promise(d=>{d(!0)}));return u({form:o.data.form,async submit(){return await l.value.validate()}}),T(()=>{C()}),J(()=>{l.value.resetFields(Object.keys(o.data.form))}),(d,p)=>{const v=_("a-cascader"),b=_("a-form-item"),$=_("a-select"),N=_("a-input"),A=_("a-upload"),c=_("a-form"),I=_("a-scrollbar");return g(),q(I,{style:{maxHeight:"calc(100vh - 250px)",overflow:"auto"}},{default:r(()=>[s(c,{ref_key:"form",ref:l,model:a(o).data.form,rules:a(o).data.rules,disabled:a(L),"auto-label-width":"","scroll-to-first-error":""},{default:r(()=>[s(b,{label:"区域",field:"areaCode"},{default:r(()=>[s(v,{"model-value":a(o).data.form.areaCode,"onUpdate:modelValue":p[0]||(p[0]=D=>a(o).data.form.areaCode=D),options:a(i).data.options,"field-names":a(i).data.fieldNames,"allow-clear":"",placeholder:"请选择区域",onChange:x},null,8,["model-value","options","field-names"])]),_:1}),s(b,{label:"所属部门",field:"deptId"},{default:r(()=>[s($,{"model-value":a(o).data.form.deptId,"onUpdate:modelValue":p[1]||(p[1]=D=>a(o).data.form.deptId=D),options:a(h).data.options,"field-names":a(h).data.fieldNames,"allow-clear":"",placeholder:"请选择所属部门"},null,8,["model-value","options","field-names"])]),_:1}),s(b,{label:"部门大类",field:"deptCateName"},{default:r(()=>[s(N,{"model-value":a(o).data.form.deptCateName,"onUpdate:modelValue":p[2]||(p[2]=D=>a(o).data.form.deptCateName=D),placeholder:"请输入部门大类"},null,8,["model-value"])]),_:1}),s(b,{label:"执法案卷",field:"file"},{default:r(()=>[s(A,{draggable:"",accept:".zip, application/zip, application/x-zip-compressed",limit:1,"show-remove-button":!a(L),"custom-request":e,"on-before-remove":n},null,8,["show-remove-button"])]),_:1})]),_:1},8,["model","rules","disabled"])]),_:1})}}}),at={class:"container"},ot={class:"detail-container"},nt={class:"detail-container-content"},st={class:"detail-container-content-item"},it={class:"detail-container-content-item-value"},lt={class:"detail-container-content-item"},dt={class:"detail-container-content-item-value"},ct={class:"detail-container-content-item"},rt={class:"detail-container-content-item-value"},mt={class:"detail-container-content-item"},pt={class:"detail-container-content-item-value"},ut={class:"detail-container-content-item"},_t={class:"detail-container-content-item-value"},ft={class:"detail-container-content-item"},vt={class:"detail-container-content-item-value"},gt={class:"detail-container-content-item"},ht={class:"detail-container-content-item-value"},bt={class:"detail-container-content-item"},wt={class:"detail-container-content-item-value"},yt={class:"detail-container"},Ct={class:"detail-container-other"},kt={class:"timeline"},xt=["onClick"],Nt={class:"timeline-item-dot-container"},Dt={class:"timeline-item-dot"},Rt={class:"timeline-item-label"},It={key:0,ref:"doc-item",class:"doc"},St=["onClick"],zt={class:"doc-item-name"},$t={class:"doc-item-name-text ellipsis-2"},At={key:1,class:"doc-empty"},Lt=F({__name:"detail",props:{id:{default:""}},setup(z){const u=z,l=y({data:{info:{},proList:[]}}),o=async()=>{const{data:m}=await k.getRecordsDetailApi(u.id);l.data.info=m.data,l.data.proList=m.proList},i=y({data:{list:[],current:0}}),C=async()=>{const{data:m}=await k.getDocListApi({id:u.id,proId:l.data.proList[i.data.current].id});i.data.list=m},x=m=>{i.data.current=m};P(()=>i.data.current,C);const h=m=>{const{toggleVisible:e}=B({component:tt,props:{url:m.filePath,name:m.writName},modalProps:{title:m.writName,width:1e3,draggable:!0,hideCancel:!0,okText:"关闭",okButtonProps:{type:"secondary"},onOk(){e()}}})};return T(()=>{Promise.all([o()]).then(()=>{C()})}),(m,e)=>{const n=_("a-empty"),d=_("a-scrollbar");return g(),q(d,{style:{maxHeight:"calc(100vh - 250px)",overflow:"auto"}},{default:r(()=>[t("div",at,[t("div",ot,[e[8]||(e[8]=t("div",{class:"detail-container-title"},[t("p",{class:"detail-container-title-text"},"基本信息")],-1)),t("div",nt,[t("div",st,[e[0]||(e[0]=t("p",{class:"detail-container-content-item-label"},"案卷名称：",-1)),t("p",it,f(a(l).data.info.name),1)]),t("div",lt,[e[1]||(e[1]=t("p",{class:"detail-container-content-item-label"},"案卷编号：",-1)),t("p",dt,f(a(l).data.info.code),1)]),t("div",ct,[e[2]||(e[2]=t("p",{class:"detail-container-content-item-label"},"所属区域：",-1)),t("p",rt,f(a(l).data.info.areaName),1)]),t("div",mt,[e[3]||(e[3]=t("p",{class:"detail-container-content-item-label"},"所属部门：",-1)),t("p",pt,f(a(l).data.info.deptName),1)]),t("div",ut,[e[4]||(e[4]=t("p",{class:"detail-container-content-item-label"},"部门大类：",-1)),t("p",_t,f(a(l).data.info.deptCateName),1)]),t("div",ft,[e[5]||(e[5]=t("p",{class:"detail-container-content-item-label"},"执法人员：",-1)),t("p",vt,f(a(l).data.info.zfyName),1)]),t("div",gt,[e[6]||(e[6]=t("p",{class:"detail-container-content-item-label"},"上传时间：",-1)),t("p",ht,f(a(l).data.info.createTime),1)]),t("div",bt,[e[7]||(e[7]=t("p",{class:"detail-container-content-item-label"},"上传人员：",-1)),t("p",wt,f(a(l).data.info.uploaderName),1)])])]),t("div",yt,[e[11]||(e[11]=t("div",{class:"detail-container-title"},[t("p",{class:"detail-container-title-text"},"案卷文书")],-1)),t("div",Ct,[t("div",kt,[(g(!0),w(V,null,O(a(l).data.proList,(p,v)=>(g(),w("div",{class:Q(["timeline-item",{"not-reached":a(i).data.current<v}]),key:v,onClick:b=>x(v)},[t("div",Nt,[t("p",Dt,f(v+1),1)]),t("p",Rt,f(p.name),1)],10,xt))),128))]),a(i).data.list.length>0?(g(),w("div",It,[(g(!0),w(V,null,O(a(i).data.list,(p,v)=>(g(),w("div",{class:"doc-item",key:v,onClick:b=>h(p)},[t("p",zt,[t("span",$t,f(p.writName),1)]),e[9]||(e[9]=t("p",{class:"doc-item-pointer"},[t("span",{class:"doc-item-pointer-text"},"点击查看")],-1)),e[10]||(e[10]=t("i",{class:"doc-item-back"},null,-1))],8,St))),128))],512)):(g(),w("div",At,[s(n)]))])])])]),_:1})}}}),Pt=X(Lt,[["__scopeId","data-v-58fabe2b"]]),Vt={class:"filter-content"},Bt={class:"select-content"},Ft={class:"search-content"},Tt={class:"search-content-buttons"},qt={class:"search"},Wt={class:"refresh"},Jt=F({__name:"index",setup(z){const u=y({data:{state:{options:[{label:"未评查",value:0},{label:"评查中",value:1},{label:"已评查",value:2}],value:""},keyword:""}}),l=Y("table"),o=y({data:{columns:[{title:"案卷名称",dataIndex:"name",align:"center",fixed:"left",width:300,minWidth:200},{title:"编号",dataIndex:"code",align:"center",width:200,minWidth:100},{title:"所属区域",dataIndex:"areaName",align:"center",width:200,minWidth:100},{title:"所属部门",dataIndex:"deptName",align:"center",width:200,minWidth:100},{title:"上传时间",dataIndex:"createTime",align:"center",width:200,minWidth:100},{title:"状态",align:"center",render({record:e}){const n=[{text:"未评查",color:"#FF0000"},{text:"评查中",color:"#206FFC"},{text:"已评查",color:"#39CA3A"}];return U("span",{style:`color: ${n[e.status].color}`},n[e.status].text)},fixed:"right",width:100,minWidth:100,headerCellClass:"hide-resizable"},{title:"操作",slotName:"optional",align:"center",fixed:"right",width:200,minWidth:200}],list:[],pagination:{show:!0,total:0,pageNum:1,pageSize:10},tableRowSelection:{width:40,type:"checkbox",selectedRowKeys:[],showCheckedAll:!0}}}),i=async()=>{const{data:e}=await k.getRecordsListApi({status:u.data.state.value,keyword:u.data.keyword,pageNum:o.data.pagination.pageNum,pageSize:o.data.pagination.pageSize}),{currentList:n,totalRecords:d}=e;o.data.list=n,o.data.pagination.total=d};P(()=>[u.data.state.value,u.data.keyword,o.data.pagination.pageSize],()=>{o.data.pagination.pageNum>1?o.data.pagination.pageNum=1:i()}),P(()=>o.data.pagination.pageNum,i);const C=()=>{const{instance:e,toggleVisible:n}=B({component:et,props:{},modalProps:{title:"案卷添加",draggable:!0,async onBeforeOk(){try{await e.value.submit()||(await k.uploadRecordsApi(e.value.form),R("success",{content:"添加成功"}),i(),n())}catch{return!1}}}})},x=async e=>{const{toggleVisible:n}=B({component:Pt,props:{id:e},modalProps:{title:"案卷详情",width:1e3,draggable:!0,hideCancel:!1},modalSlots:{footer:()=>[U(M,{onClick:n},{default:()=>"关闭"})]}})},h=e=>{W("warning",{title:"删除",content:"确认删除该案卷吗？",okText:"确认",hideCancel:!1,onOk:async()=>{try{await k.deleteRecordsApi(e),R("success",{content:"删除成功"}),i()}catch{R("error",{content:"删除失败"})}}})},m=e=>{W("info",{title:"评查",content:"确认开始评查该案卷？",hideCancel:!1,onOk:async()=>{try{await k.startEvaluationApi(e),R("success",{content:"已开始评查，请等待评查结果"}),i()}catch{R("error",{content:"评查失败"})}}})};return T(()=>{i()}),(e,n)=>{const d=_("a-select"),p=_("a-space"),v=E,b=_("a-input-search"),$=_("icon-sync"),N=_("a-link"),A=K;return g(),w(V,null,[t("div",Vt,[t("div",Bt,[s(d,{"model-value":a(u).data.state.value,"onUpdate:modelValue":n[0]||(n[0]=c=>a(u).data.state.value=c),options:a(u).data.state.options,style:{width:"200px"},"allow-clear":"",placeholder:"选择状态"},null,8,["model-value","options"])]),t("div",Ft,[s(p,null,{default:r(()=>[t("div",Tt,[s(p,null,{default:r(()=>[s(M,{type:"primary",onClick:C},{default:r(()=>n[5]||(n[5]=[S(" 导入 ",-1)])),_:1,__:[5]})]),_:1})]),t("div",qt,[s(b,{"default-value":a(u).data.keyword,"allow-clear":"","search-button":"","button-text":"查询",placeholder:"输入关键字搜索",onChange:n[1]||(n[1]=c=>a(u).data.keyword=c)},{"button-icon":r(()=>[s(v,{icon:"icon-search"})]),_:1},8,["default-value"])]),t("div",Wt,[s($,{spin:a(L),onClick:i},null,8,["spin"])])]),_:1})])]),s(A,{ref_key:"table",ref:l,"row-key":"id","selected-keys":a(o).data.tableRowSelection.selectedRowKeys,"onUpdate:selectedKeys":n[2]||(n[2]=c=>a(o).data.tableRowSelection.selectedRowKeys=c),"row-selection":a(o).data.tableRowSelection,columns:a(o).data.columns,data:a(o).data.list,pagination:a(o).data.pagination,"column-resizable":!0,onCurrentChange:n[3]||(n[3]=c=>a(o).data.pagination.pageNum=c),onPageSizeChange:n[4]||(n[4]=c=>a(o).data.pagination.pageSize=c)},{optional:r(({record:c})=>[s(p,{size:"medium"},{default:r(()=>[s(N,{status:"danger",hoverable:!1,onClick:I=>h(c.id)},{default:r(()=>n[6]||(n[6]=[S(" 删除 ",-1)])),_:2,__:[6]},1032,["onClick"]),s(N,{hoverable:!1,onClick:I=>x(c.id)},{default:r(()=>n[7]||(n[7]=[S(" 查看 ",-1)])),_:2,__:[7]},1032,["onClick"]),[0].includes(c.status)?(g(),q(N,{key:0,status:"success",hoverable:!1,onClick:I=>m(c.id)},{default:r(()=>n[8]||(n[8]=[S(" 开始评查 ",-1)])),_:2,__:[8]},1032,["onClick"])):Z("",!0)]),_:2},1024)]),_:1},8,["selected-keys","row-selection","columns","data","pagination"])],64)}}});export{Jt as default};
