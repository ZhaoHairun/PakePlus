import{_ as re}from"./arco-table-D7Ntzbsx.js";import{_ as ie}from"./arco-icon-CunFPY5n.js";import{D,K as ce}from"./api-CmsgK-9p.js";import{l as E,a as I,s as M}from"./index-DP0JwgWw.js";import{C as ue}from"./area-data-D0wmM6tf.js";import{d as U,a as J,r as $,s as F,B as Q,f as r,h as v,o as c,w as e,e as n,u as o,p as O,b as k,c as L,F as A,m as N,i as K,t as q,n as X,_ as Y,G as H,y as me,q as G,z as pe}from"./index-B3mkc1PU.js";import{_ as T,u as j}from"./useRenderModal-BiI04mzw.js";const _e=U({__name:"add",props:{id:{default:""}},setup(P,{expose:h}){const C=P,d=J(),t=$({data:{form:{id:"",areaCode:"",name:""},rules:{areaCode:[{required:!0,message:"请选择所属区域"}],name:[{required:!0,message:"请输入部门名称"}]}}}),S=async()=>{const{data:w}=await D.getDeptDetailApi(C.id);Object.assign(t.data.form,{id:w.id,areaCode:w.areaCode,name:w.name})},f=$({data:{options:[],fieldNames:{value:"code",label:"name"}}}),u=async()=>{f.data.options=await ue("pcaCode")};return h({form:t.data.form,async submit(){return await d.value.validate()}}),F(()=>{u(),C.id&&S()}),Q(()=>{d.value.resetFields(Object.keys(t.data.form))}),(w,s)=>{const a=r("a-cascader"),_=r("a-form-item"),b=r("a-input"),x=r("a-form"),g=r("a-scrollbar");return c(),v(g,{style:{maxHeight:"calc(100vh - 250px)",overflow:"auto"}},{default:e(()=>[n(x,{ref_key:"form",ref:d,model:o(t).data.form,rules:o(t).data.rules,disabled:o(E),"auto-label-width":"","scroll-to-first-error":""},{default:e(()=>[n(_,{label:"所属区域",field:"areaCode"},{default:e(()=>[n(a,{"model-value":o(t).data.form.areaCode,"onUpdate:modelValue":s[0]||(s[0]=y=>o(t).data.form.areaCode=y),options:o(f).data.options,"field-names":{value:"code",label:"name"},"allow-clear":"",placeholder:"请选择所属区域"},null,8,["model-value","options"])]),_:1}),n(_,{label:"部门名称",field:"name"},{default:e(()=>[n(b,{"model-value":o(t).data.form.name,"onUpdate:modelValue":s[1]||(s[1]=y=>o(t).data.form.name=y),placeholder:"请输入部门名称"},null,8,["model-value"])]),_:1})]),_:1},8,["model","rules","disabled"])]),_:1})}}}),fe={class:"select-keyword"},we=["onClick"],ye=U({__name:"add-doc",props:{id:{default:""},deptId:{default:""}},setup(P,{expose:h}){const C=P,d=J(),t=$({data:{form:{id:"",deptProcessId:"",name:"",sort:0,wsKeywordList:[]},rules:{deptProcessId:[{required:!0,message:"请选择文书流程"}],name:[{required:!0,message:"请输入文书名称"}],sort:[{required:!0,message:"请输入排序"}]}}}),S=async()=>{const{data:l}=await D.getDeptProDocDetailApi(C.id);Object.assign(t.data.form,{id:l.id,deptProcessId:l.deptProcessId,name:l.name,sort:+l.sort,wsKeywordList:l.wsKeywordList||[]})},f=O(()=>l=>t.data.form.wsKeywordList.some(i=>i.wsKeywordId===l)),u=$({data:{fieldNames:{label:"name",value:"id"},list:[]}}),w=async()=>{const{data:l}=await D.getDeptProListApi(C.deptId);u.data.list=l.currentList},s=$({data:{list:[],value:""}}),a=async()=>{const{data:l}=await ce.getKeywordGroupListApi();s.data.list=l},_=O(()=>s.data.list.map(l=>l.dataList).flat()),b=O(()=>t.data.form.wsKeywordList.map(l=>l.wsKeywordId).flat()),x=l=>{const i=b.value.indexOf(l.id);i<0?t.data.form.wsKeywordList.push({name:l.name,wsKeywordId:l.id,mustInputStatusBoolean:!1}):t.data.form.wsKeywordList.splice(i,1)},g=O(()=>_.value.filter(i=>!b.value.includes(i.id))||[]),y=l=>{s.data.value="";const i=_.value.find(V=>V.id===l);x({id:l,name:i.name})},m=(l,i)=>b.value.includes(i.id)?!1:i.name.toLowerCase().includes(l.toLowerCase());return h({form:t.data.form,async submit(){return await d.value.validate()}}),F(()=>{w(),a(),C.id&&S()}),Q(()=>{d.value.resetFields(Object.keys(t.data.form))}),(l,i)=>{const V=r("a-select"),z=r("a-form-item"),Z=r("a-input"),ee=r("a-input-number"),te=r("a-checkbox"),ae=r("a-tag"),W=r("a-space"),oe=r("a-form"),ne=r("a-empty"),se=r("a-collapse-item"),le=r("a-collapse"),de=r("a-scrollbar");return c(),v(de,{style:{maxHeight:"calc(100vh - 250px)",overflow:"auto"}},{default:e(()=>[n(oe,{ref_key:"form",ref:d,model:o(t).data.form,rules:o(t).data.rules,disabled:o(E),"auto-label-width":"","scroll-to-first-error":""},{default:e(()=>[n(z,{label:"文书流程",field:"deptProcessId"},{default:e(()=>[n(V,{"model-value":o(t).data.form.deptProcessId,"onUpdate:modelValue":i[0]||(i[0]=p=>o(t).data.form.deptProcessId=p),options:o(u).data.list,"field-names":o(u).data.fieldNames,"allow-clear":"",placeholder:"请选择文书流程"},null,8,["model-value","options","field-names"])]),_:1}),n(z,{label:"文书名称",field:"name"},{default:e(()=>[n(Z,{"model-value":o(t).data.form.name,"onUpdate:modelValue":i[1]||(i[1]=p=>o(t).data.form.name=p),placeholder:"请输入文书名称"},null,8,["model-value"])]),_:1}),n(z,{label:"文书排序",field:"sort"},{default:e(()=>[n(ee,{"model-value":o(t).data.form.sort,"onUpdate:modelValue":i[2]||(i[2]=p=>o(t).data.form.sort=p),min:0,step:1,precision:0,placeholder:"请输入文书排序"},null,8,["model-value"])]),_:1}),n(z,{label:"关键词",field:"wsKeywordIdList"},{help:e(()=>i[4]||(i[4]=[k("div",{style:{"margin-bottom":"10px"}},[k("span",{style:{color:"rgb(var(--red-6))"}},"选中为必填关键词，未选中为非必填关键词。")],-1)])),extra:e(()=>[n(W,{wrap:""},{default:e(()=>[(c(!0),L(A,null,N(o(t).data.form.wsKeywordList,p=>(c(),v(ae,{key:p.wsKeywordId,closable:!0,size:"large",onClose:R=>x({id:p.wsKeywordId,name:p.name})},{default:e(()=>[n(te,{"model-value":p.mustInputStatusBoolean,"onUpdate:modelValue":R=>p.mustInputStatusBoolean=R},{default:e(()=>[K(q(p.name),1)]),_:2},1032,["model-value","onUpdate:modelValue"])]),_:2},1032,["onClose"]))),128))]),_:1})]),default:e(()=>[n(V,{"model-value":o(s).data.value,"onUpdate:modelValue":i[3]||(i[3]=p=>o(s).data.value=p),options:o(g),"field-names":{label:"name",value:"id"},"virtual-list-props":{height:200},"filter-option":m,"allow-clear":"","allow-search":"",placeholder:"搜索关键词",onChange:y},null,8,["model-value","options"])]),_:1})]),_:1},8,["model","rules","disabled"]),k("div",fe,[i[5]||(i[5]=k("p",{class:"select-keyword-title"},"选择关键词",-1)),n(le,{accordion:""},{default:e(()=>[(c(!0),L(A,null,N(o(s).data.list,(p,R)=>(c(),v(se,{key:R,header:p.name},{default:e(()=>[p.dataList.length?(c(),v(W,{key:0,wrap:""},{default:e(()=>[(c(!0),L(A,null,N(p.dataList,B=>(c(),L("p",{key:B.id,class:X(["tag",{active:o(f)(B.id)}]),onClick:Se=>x(B)},q(B.name),11,we))),128))]),_:2},1024)):(c(),v(ne,{key:1}))]),_:2},1032,["header"]))),128))]),_:1})])]),_:1})}}}),ge=Y(ye,[["__scopeId","data-v-0801d4e4"]]),ve={class:"filter-content"},be={class:"search-content"},ke={class:"search-content-buttons"},he={class:"tag-container"},Ce=U({__name:"doc",props:{deptId:{default:""}},setup(P){const h=P,C=$({data:{list:[]}}),d=async()=>{const{data:f}=await D.getDeptProDocTreeApi(h.deptId);C.data.list=f},t=f=>{const{instance:u,toggleVisible:w}=j({component:ge,props:{id:f,deptId:h.deptId},modalProps:{title:`${f?"编辑":"添加"}文书`,width:800,draggable:!0,async onBeforeOk(){try{await u.value.submit()||(await D.addDeptProDocApi(u.value.form),I("success",{content:"添加成功"}),d(),w())}catch{return!1}}}})},S=f=>{M("warning",{title:"删除",content:"确认删除该文书吗？",okText:"确认",hideCancel:!1,onOk:async()=>{try{await D.deleteDeptProDocApi(f),I("success",{content:"删除成功"}),d()}catch{I("error",{content:"删除失败"})}}})};return F(()=>{d()}),(f,u)=>{const w=T,s=r("a-space"),a=r("a-empty"),_=r("a-collapse-item"),b=r("a-collapse"),x=r("a-scrollbar");return c(),v(x,{style:{maxHeight:"calc(100vh - 250px)",overflow:"auto"}},{default:e(()=>[k("div",ve,[k("div",be,[n(s,null,{default:e(()=>[k("div",ke,[n(s,null,{default:e(()=>[n(w,{type:"primary",onClick:u[0]||(u[0]=g=>t(""))},{default:e(()=>u[1]||(u[1]=[K(" 添加 ",-1)])),_:1,__:[1]})]),_:1})])]),_:1})])]),k("div",he,[n(b,{accordion:"","destroy-on-hide":""},{default:e(()=>[(c(!0),L(A,null,N(o(C).data.list,g=>(c(),v(_,{key:g.id,header:g.name},{default:e(()=>[g.writList.length?(c(),v(b,{key:0,accordion:"","destroy-on-hide":""},{default:e(()=>[(c(!0),L(A,null,N(g.writList,y=>(c(),v(_,{key:y.id,header:y.name},{extra:e(()=>[n(s,{size:"medium"},{default:e(()=>[n(w,{size:"small",status:"warning",onClick:H(m=>t(y.id),["stop"])},{default:e(()=>u[2]||(u[2]=[K(" 编辑 ",-1)])),_:2,__:[2]},1032,["onClick"]),n(w,{size:"small",status:"danger",onClick:H(m=>S(y.id),["stop"])},{default:e(()=>u[3]||(u[3]=[K(" 删除 ",-1)])),_:2,__:[3]},1032,["onClick"])]),_:2},1024)]),default:e(()=>[y.keywordList.length?(c(),v(s,{key:0,wrap:""},{default:e(()=>[(c(!0),L(A,null,N(y.keywordList,(m,l)=>(c(),L("p",{key:l,class:X(["tag",{"tag-must":m.mustInputStatusBoolean}])},q(m.name),3))),128))]),_:2},1024)):(c(),v(a,{key:1}))]),_:2},1032,["header"]))),128))]),_:2},1024)):(c(),v(a,{key:1}))]),_:2},1032,["header"]))),128))]),_:1})])]),_:1})}}}),De=Y(Ce,[["__scopeId","data-v-74a254f4"]]),xe={class:"filter-content"},Ie={class:"search-content"},Ke={class:"search-content-buttons"},Le={class:"search"},Be=U({__name:"index",setup(P){const h=$({data:{keyword:""}}),C=me("table"),d=$({data:{columns:[{title:"所属区域",dataIndex:"areaNames",align:"center",minWidth:200},{title:"部门名称",dataIndex:"name",align:"center",minWidth:200},{title:"添加时间",dataIndex:"createTime",align:"center",minWidth:200},{title:"操作",slotName:"optional",align:"center",fixed:"right",minWidth:200}],list:[],pagination:{show:!0,total:0,pageNum:1,pageSize:10},tableRowSelection:{width:40,type:"checkbox",selectedRowKeys:[],showCheckedAll:!0}}}),t=async()=>{const{data:s}=await D.getDeptListApi({areaCode:"",keyword:h.data.keyword,pageNum:d.data.pagination.pageNum,pageSize:d.data.pagination.pageSize}),{currentList:a,totalRecords:_}=s;d.data.list=a,d.data.pagination.total=_};G(()=>[h.data.keyword,d.data.pagination.pageSize],()=>{d.data.pagination.pageNum>1?d.data.pagination.pageNum=1:t()}),G(()=>d.data.pagination.pageNum,t);const S=s=>{const{instance:a,toggleVisible:_}=j({component:_e,props:{id:s},modalProps:{title:`${s?"编辑":"添加"}部门`,draggable:!0,async onBeforeOk(){try{await a.value.submit()||(await D.addDeptApi(a.value.form),I("success",{content:"添加成功"}),t(),_())}catch{return!1}}}})},f=s=>{M("warning",{title:"删除",content:"确认删除该部门吗？",okText:"确认",hideCancel:!1,onOk:async()=>{try{await D.deleteDeptApi([s]),I("success",{content:"删除成功"}),t()}catch{I("error",{content:"删除失败"})}}})},u=()=>{var s;if(!((s=d.data.tableRowSelection.selectedRowKeys)!=null&&s.length)){I("warning",{content:"请选择要删除的部门"});return}M("warning",{title:"删除",content:"确认批量删除部门吗？",okText:"确认",hideCancel:!1,onOk:async()=>{try{await D.deleteDeptApi(d.data.tableRowSelection.selectedRowKeys),I("success",{content:"删除成功"}),t()}catch{I("error",{content:"删除失败"})}}})},w=s=>{const{toggleVisible:a}=j({component:De,props:{deptId:s},modalProps:{title:"查看文书",width:800,draggable:!0},modalSlots:{footer:()=>[pe(T,{onClick:a},{default:()=>"关闭"})]}})};return F(()=>{t()}),(s,a)=>{const _=r("a-space"),b=ie,x=r("a-input-search"),g=r("a-link"),y=re;return c(),L(A,null,[k("div",xe,[k("div",Ie,[n(_,null,{default:e(()=>[k("div",Ke,[n(_,null,{default:e(()=>[n(T,{type:"primary",onClick:a[0]||(a[0]=m=>S(""))},{default:e(()=>a[5]||(a[5]=[K(" 添加 ",-1)])),_:1,__:[5]}),n(T,{type:"outline",onClick:u},{default:e(()=>a[6]||(a[6]=[K(" 批量删除 ",-1)])),_:1,__:[6]})]),_:1})]),k("div",Le,[n(x,{"default-value":o(h).data.keyword,"allow-clear":"","search-button":"","button-text":"查询",placeholder:"输入关键字搜索",onChange:a[1]||(a[1]=m=>o(h).data.keyword=m)},{"button-icon":e(()=>[n(b,{icon:"icon-search"})]),_:1},8,["default-value"])])]),_:1})])]),n(y,{ref_key:"table",ref:C,"row-key":"id","selected-keys":o(d).data.tableRowSelection.selectedRowKeys,"onUpdate:selectedKeys":a[2]||(a[2]=m=>o(d).data.tableRowSelection.selectedRowKeys=m),"row-selection":o(d).data.tableRowSelection,columns:o(d).data.columns,data:o(d).data.list,pagination:o(d).data.pagination,"column-resizable":!0,onCurrentChange:a[3]||(a[3]=m=>o(d).data.pagination.pageNum=m),onPageSizeChange:a[4]||(a[4]=m=>o(d).data.pagination.pageSize=m)},{optional:e(({record:m})=>[n(_,{size:"medium"},{default:e(()=>[n(g,{status:"warning",hoverable:!1,onClick:l=>S(m.id)},{default:e(()=>a[7]||(a[7]=[K(" 编辑 ",-1)])),_:2,__:[7]},1032,["onClick"]),n(g,{status:"danger",hoverable:!1,onClick:l=>f(m.id)},{default:e(()=>a[8]||(a[8]=[K(" 删除 ",-1)])),_:2,__:[8]},1032,["onClick"]),n(g,{hoverable:!1,onClick:l=>w(m.id)},{default:e(()=>a[9]||(a[9]=[K(" 查看文书 ",-1)])),_:2,__:[9]},1032,["onClick"])]),_:2},1024)]),_:1},8,["selected-keys","row-selection","columns","data","pagination"])],64)}}});export{Be as default};
